\hypertarget{_e_s_p01__comm_8c}{}\section{/home/guilherme/workspace.kds/\+E\+A076\+\_\+\+P\+E/\+Programmer\+\_\+code/\+Libraries/\+E\+S\+P01\+\_\+comm.c File Reference}
\label{_e_s_p01__comm_8c}\index{/home/guilherme/workspace.\+kds/\+E\+A076\+\_\+\+P\+E/\+Programmer\+\_\+code/\+Libraries/\+E\+S\+P01\+\_\+comm.\+c@{/home/guilherme/workspace.\+kds/\+E\+A076\+\_\+\+P\+E/\+Programmer\+\_\+code/\+Libraries/\+E\+S\+P01\+\_\+comm.\+c}}


This file contains the F\+SM implementation for communicating with the M\+Q\+TT Broker (using the E\+S\+P-\/01 module).  


{\ttfamily \#include $<$E\+S\+P01\+\_\+comm.\+h$>$}\newline
{\ttfamily \#include $<$L\+O\+G.\+h$>$}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$U\+A\+R\+T2\+Events.\+h$>$}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a586542b79d00e4db7e1d5a667ae83a2b}\label{_e_s_p01__comm_8c_a586542b79d00e4db7e1d5a667ae83a2b}} 
\#define {\bfseries W\+I\+F\+I\+\_\+\+S\+S\+ID}~\char`\"{}\textbackslash{}\char`\"{}E\+A076\+R\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a8685d8aff7e570048090a3a51afceb07}\label{_e_s_p01__comm_8c_a8685d8aff7e570048090a3a51afceb07}} 
\#define {\bfseries W\+I\+F\+I\+\_\+\+P\+A\+S\+S\+W\+O\+RD}~\char`\"{}\textbackslash{}\char`\"{}F\+R\+D\+M\+K\+L25\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a299e41bf5836749387f76183b3c24775}\label{_e_s_p01__comm_8c_a299e41bf5836749387f76183b3c24775}} 
\#define {\bfseries M\+Q\+T\+T\+\_\+\+IP}~\char`\"{}\textbackslash{}\char`\"{}192.\+168.\+1.\+111\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_aa8632baff6bbb5004385998918f1e6bd}\label{_e_s_p01__comm_8c_aa8632baff6bbb5004385998918f1e6bd}} 
\#define {\bfseries M\+Q\+T\+T\+\_\+\+P\+O\+RT}~\char`\"{}1883\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_acb6cfe3c2c6027787471e583ad3575c9}\label{_e_s_p01__comm_8c_acb6cfe3c2c6027787471e583ad3575c9}} 
\#define {\bfseries M\+Q\+T\+T\+\_\+\+U\+S\+E\+R\+N\+A\+ME}~\char`\"{}\textbackslash{}\char`\"{}aluno\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a45f4b2d4acbdbc5897952a514f4d6abf}\label{_e_s_p01__comm_8c_a45f4b2d4acbdbc5897952a514f4d6abf}} 
\#define {\bfseries M\+Q\+T\+T\+\_\+\+P\+A\+S\+S\+W\+O\+RD}~\char`\"{}\textbackslash{}\char`\"{}U\+N\+I\+C\+A\+M\+P\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_aeb45f67e13bbc114e5279471063ea6c3}\label{_e_s_p01__comm_8c_aeb45f67e13bbc114e5279471063ea6c3}} 
\#define {\bfseries S\+M\+A\+R\+T\+P\+H\+O\+N\+E\+\_\+\+T\+O\+P\+IC}~\char`\"{}\textbackslash{}\char`\"{}E\+A076/grupo\+D3/celular\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a7e02ee98d77b30fead4648fcb7c02f18}\label{_e_s_p01__comm_8c_a7e02ee98d77b30fead4648fcb7c02f18}} 
\#define {\bfseries S\+M\+A\+R\+T\+P\+H\+O\+N\+E\+\_\+\+T\+O\+P\+I\+C\+\_\+\+WQ}~\char`\"{}E\+A076/grupo\+D3/celular\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a7fbabfb4a7bd44a5970be5465e00eb25}\label{_e_s_p01__comm_8c_a7fbabfb4a7bd44a5970be5465e00eb25}} 
\#define {\bfseries T\+E\+M\+P\+E\+R\+A\+T\+U\+R\+E\+\_\+\+T\+O\+P\+IC}~\char`\"{}E\+A076/grupo\+D3/temp\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a3a7b656132fea12304108ed97d9d5728}\label{_e_s_p01__comm_8c_a3a7b656132fea12304108ed97d9d5728}} 
\#define {\bfseries E\+S\+P\+\_\+\+T\+O\+P\+IC}~\char`\"{}\textbackslash{}\char`\"{}E\+A076/grupo\+D3/E\+S\+P\textbackslash{}\char`\"{}\char`\"{}
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a09886d6ba96e67553bf3c49ed8ade975}\label{_e_s_p01__comm_8c_a09886d6ba96e67553bf3c49ed8ade975}} 
\#define {\bfseries M\+A\+X\+\_\+\+T\+O\+K\+E\+NS}~32
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a803292a2b6f66be0d5e5d0a0864389ac}\label{_e_s_p01__comm_8c_a803292a2b6f66be0d5e5d0a0864389ac}} 
\#define {\bfseries I\+P\+\_\+\+N\+U\+M\+B\+E\+R\+\_\+\+S\+I\+ZE}~32
\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_ae01dbae885bc8abecb82bd865515c081}\label{_e_s_p01__comm_8c_ae01dbae885bc8abecb82bd865515c081}} 
\#define {\bfseries M\+A\+C\+\_\+\+A\+D\+D\+R\+\_\+\+S\+I\+ZE}~64
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
bool \hyperlink{_e_s_p01__comm_8c_a93f264a629ebca38a12689abd4f83fc8}{comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors} ()
\begin{DoxyCompactList}\small\item\em A function that checks if there is a connection error. \end{DoxyCompactList}\item 
void \hyperlink{_e_s_p01__comm_8c_ab2d2bcb7314dc4ab3839b02daf45ab9c}{comm\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em A function starts the communication with E\+S\+P01. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_e_s_p01__comm_8c_a10df40ab29db50aa6d23cf3c1e01f8b6}\label{_e_s_p01__comm_8c_a10df40ab29db50aa6d23cf3c1e01f8b6}} 
C\+O\+M\+M\+\_\+\+S\+T\+A\+T\+US {\bfseries comm\+\_\+status} ()
\item 
void \hyperlink{_e_s_p01__comm_8c_aa32b4183bfbec8fb1b879a653ad14c99}{comm\+\_\+send\+\_\+msg} ()
\begin{DoxyCompactList}\small\item\em A function triggers the message sending process (to E\+S\+P01) \end{DoxyCompactList}\item 
void \hyperlink{_e_s_p01__comm_8c_a144515221297b75e9db38676fceae827}{comm\+\_\+response} ()
\begin{DoxyCompactList}\small\item\em A function implementing a F\+SM to respond to a received msg. \end{DoxyCompactList}\item 
void \hyperlink{_e_s_p01__comm_8c_ae0bc91bb9b2098a47360820649cea4e2}{comm\+\_\+parse} ()
\begin{DoxyCompactList}\small\item\em A function implementing a F\+SM to parse a received msg. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
This file contains the F\+SM implementation for communicating with the M\+Q\+TT Broker (using the E\+S\+P-\/01 module). 



\subsection{Function Documentation}
\mbox{\Hypertarget{_e_s_p01__comm_8c_a93f264a629ebca38a12689abd4f83fc8}\label{_e_s_p01__comm_8c_a93f264a629ebca38a12689abd4f83fc8}} 
\index{E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}!comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors@{comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors}}
\index{comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors@{comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors}!E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}}
\subsubsection{\texorpdfstring{comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors()}{comm\_are\_there\_conn\_errors()}}
{\footnotesize\ttfamily bool comm\+\_\+are\+\_\+there\+\_\+conn\+\_\+errors (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A function that checks if there is a connection error. 

This function is responsible for checking if the message received is one of global connection errors. \mbox{\Hypertarget{_e_s_p01__comm_8c_ab2d2bcb7314dc4ab3839b02daf45ab9c}\label{_e_s_p01__comm_8c_ab2d2bcb7314dc4ab3839b02daf45ab9c}} 
\index{E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}!comm\+\_\+init@{comm\+\_\+init}}
\index{comm\+\_\+init@{comm\+\_\+init}!E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}}
\subsubsection{\texorpdfstring{comm\+\_\+init()}{comm\_init()}}
{\footnotesize\ttfamily void comm\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A function starts the communication with E\+S\+P01. 

This function is responsible for starting the communication with E\+S\+P01 (consequently with the M\+Q\+TT broker). \mbox{\Hypertarget{_e_s_p01__comm_8c_ae0bc91bb9b2098a47360820649cea4e2}\label{_e_s_p01__comm_8c_ae0bc91bb9b2098a47360820649cea4e2}} 
\index{E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}!comm\+\_\+parse@{comm\+\_\+parse}}
\index{comm\+\_\+parse@{comm\+\_\+parse}!E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}}
\subsubsection{\texorpdfstring{comm\+\_\+parse()}{comm\_parse()}}
{\footnotesize\ttfamily void comm\+\_\+parse (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A function implementing a F\+SM to parse a received msg. 

This function is responsible for parsing a received message and change the state of the F\+SM (if needed). the last received message from the M\+Q\+TT broker. It also logs some information when the connection is already established. \mbox{\Hypertarget{_e_s_p01__comm_8c_a144515221297b75e9db38676fceae827}\label{_e_s_p01__comm_8c_a144515221297b75e9db38676fceae827}} 
\index{E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}!comm\+\_\+response@{comm\+\_\+response}}
\index{comm\+\_\+response@{comm\+\_\+response}!E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}}
\subsubsection{\texorpdfstring{comm\+\_\+response()}{comm\_response()}}
{\footnotesize\ttfamily void comm\+\_\+response (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A function implementing a F\+SM to respond to a received msg. 

This function is responsible for assembling a response to the last received message from the M\+Q\+TT broker. It also implements connection retries and logs the process. Here\textquotesingle{}s one the main current problems\+: It\textquotesingle{}s not possible to choose the desired topic to publish into. Since I\textquotesingle{}m testing the temperature reading, the temperature topic is hard-\/coded.\mbox{\Hypertarget{_e_s_p01__comm_8c_aa32b4183bfbec8fb1b879a653ad14c99}\label{_e_s_p01__comm_8c_aa32b4183bfbec8fb1b879a653ad14c99}} 
\index{E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}!comm\+\_\+send\+\_\+msg@{comm\+\_\+send\+\_\+msg}}
\index{comm\+\_\+send\+\_\+msg@{comm\+\_\+send\+\_\+msg}!E\+S\+P01\+\_\+comm.\+c@{E\+S\+P01\+\_\+comm.\+c}}
\subsubsection{\texorpdfstring{comm\+\_\+send\+\_\+msg()}{comm\_send\_msg()}}
{\footnotesize\ttfamily void comm\+\_\+send\+\_\+msg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



A function triggers the message sending process (to E\+S\+P01) 

This function is responsible for triggering the sending message process (to E\+S\+P01). It also notifies the main loop that a message is being sent with U\+A\+R\+T2. 